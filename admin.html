<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—˜ë¦¼êµíšŒ ê´€ë¦¬ì í˜ì´ì§€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            padding: 60px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2C3E50;
            margin-bottom: 40px;
            font-size: 1.8rem;
            font-weight: 600;
            text-align: center;
        }
        
        .login-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .login-box p {
            color: #666;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        
        input[type="text"],
        input[type="password"] {
            width: 100%;
            max-width: 400px;
            padding: 14px 16px;
            border: 1px solid #ddd;
            font-size: 1rem;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }
        
        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            border-color: #2C5F8D;
        }
        
        button {
            background: #2C5F8D;
            color: white;
            border: none;
            padding: 14px 40px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background 0.3s ease;
            width: 100%;
            max-width: 400px;
        }
        
        button:hover {
            background: #1E4263;
        }
        
        .admin-menu {
            display: none;
            margin-top: 30px;
        }
        
        .admin-menu.active {
            display: block;
        }
        
        .admin-section {
            margin-bottom: 30px;
            padding: 24px;
            background: #f9f9f9;
            border-left: 3px solid #2C5F8D;
        }
        
        .admin-section h2 {
            color: #2C3E50;
            margin-bottom: 20px;
            font-size: 1.3rem;
            font-weight: 600;
        }
        
        textarea, input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            font-size: 0.95rem;
            margin-bottom: 12px;
            font-family: inherit;
            transition: border-color 0.3s ease;
        }
        
        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: #2C5F8D;
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn-small {
            padding: 10px 24px;
            font-size: 0.9rem;
            width: auto;
            max-width: none;
        }
        
        .status {
            padding: 12px 16px;
            background: #d4edda;
            color: #155724;
            margin-top: 10px;
            display: none;
            text-align: center;
        }
        
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #2C5F8D;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .back-link:hover {
            color: #1E4263;
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 2rem;
            cursor: pointer;
            color: #999;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            line-height: 30px;
        }
        
        .modal .close:hover {
            color: #333;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 20px;
            }
            
            .container {
                padding: 40px 20px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            input[type="text"],
            input[type="password"], 
            button {
                max-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì—˜ë¦¼êµíšŒ ê´€ë¦¬ì í˜ì´ì§€</h1>
        
        <div class="login-box" id="loginBox">
            <p>ê´€ë¦¬ì ë¡œê·¸ì¸</p>
            <input type="text" id="adminId" placeholder="ì•„ì´ë”” ì…ë ¥" onkeypress="if(event.key==='Enter') checkPassword()">
            <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" onkeypress="if(event.key==='Enter') checkPassword()">
            <button onclick="checkPassword()">ë¡œê·¸ì¸</button>
        </div>
        
        <div class="admin-menu" id="adminMenu">
            <h2>ê´€ë¦¬ ë©”ë‰´</h2>
            
            <div class="admin-section">
                <h2>ê²Œì‹œíŒ ê³µì§€ì‚¬í•­ ê´€ë¦¬</h2>
                <div style="margin-bottom: 15px;">
                    <input type="text" id="boardSearch" placeholder="ê²Œì‹œê¸€ ê²€ìƒ‰..." style="width: 100%; max-width: 400px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-bottom: 10px;" onkeyup="filterBoardPosts()">
                    <button onclick="openBoardPostModal()" class="btn-small" style="margin-right: 10px;">+ ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</button>
                    <button onclick="loadBoardPosts()" class="btn-small" style="background: #6c757d;">ìƒˆë¡œê³ ì¹¨</button>
                </div>
                <div id="boardPostList" style="margin-top: 15px;"></div>
            </div>
            
            <div class="admin-section">
                <h2>YouTube ì±„ë„ ì„¤ì •</h2>
                <input type="text" id="youtubeChannelId" placeholder="YouTube ì±„ë„ ID ì…ë ¥">
                <button onclick="saveChannelId()" class="btn-small">ì €ì¥</button>
            </div>
            
            <div class="admin-section">
                <h2>ì„¤êµ ì˜ìƒ URL ì¶”ê°€</h2>
                <input type="text" id="videoUrl" placeholder="https://www.youtube.com/watch?v=xxxxx">
                <button onclick="addVideoUrl()" class="btn-small">ì¶”ê°€</button>
                <div id="videoList" style="margin-top: 15px;"></div>
            </div>
            
            <div class="admin-section">
                <h2>í–‰ì‚¬ì•¨ë²” ê´€ë¦¬</h2>
                <input type="file" id="albumImageFile" accept="image/*" onchange="handleAlbumImageUpload(event)" style="margin-bottom: 10px;">
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">ë˜ëŠ” ì´ë¯¸ì§€ URL ì…ë ¥:</p>
                <input type="text" id="albumImageUrl" placeholder="ì´ë¯¸ì§€ URL ì…ë ¥ (ì˜ˆ: https://example.com/image.jpg)" style="margin-bottom: 10px;">
                <button onclick="addAlbumImageFromUrl()" class="btn-small">URLë¡œ ì¶”ê°€</button>
                <div id="albumList" style="margin-top: 15px;"></div>
            </div>
            
            <div class="admin-section">
                <h2>êµíšŒì†Œì‹ ë°” ê´€ë¦¬</h2>
                <p style="font-size: 0.9rem; color: #666; margin-bottom: 15px;">ë©”ì¸ í˜ì´ì§€ ìƒë‹¨ì— í‘œì‹œë˜ëŠ” êµíšŒì†Œì‹ ìŠ¤í¬ë¡¤ ë°”ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                <button onclick="openNewsScrollModal()" class="btn-small">+ ìƒˆ ì†Œì‹ ì¶”ê°€</button>
                <div id="newsScrollList" style="margin-top: 15px;"></div>
            </div>
            
            <div class="admin-section">
                <h2>ì£¼ë³´ê´‘ê³  ê´€ë¦¬</h2>
                <button onclick="openBulletinModal()" class="btn-small">+ ìƒˆ ì£¼ë³´ ì¶”ê°€</button>
                <div id="bulletinList" style="margin-top: 15px;"></div>
            </div>
            
            <!-- ì£¼ë³´ ì‘ì„± ëª¨ë‹¬ -->
            <div id="bulletinModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 600px;">
                    <span class="close" onclick="closeBulletinModal()">&times;</span>
                    <h2 id="bulletinModalTitle">ìƒˆ ì£¼ë³´ ì¶”ê°€</h2>
                    <form id="bulletinForm" onsubmit="saveBulletin(event)">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì œëª© *</label>
                            <input type="text" id="bulletinTitle" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ë‚ ì§œ *</label>
                            <input type="text" id="bulletinDate" required placeholder="ì˜ˆ: 2025.10.19" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ë‚´ìš©</label>
                            <textarea id="bulletinContent" rows="5" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit;"></textarea>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì´ë¯¸ì§€</label>
                            <input type="file" id="bulletinImageFile" accept="image/*" onchange="handleBulletinImageUpload(event)" style="margin-bottom: 10px;">
                            <p style="font-size: 0.85rem; color: #666; margin-bottom: 5px;">ë˜ëŠ” ì´ë¯¸ì§€ URL:</p>
                            <input type="text" id="bulletinImageUrl" placeholder="ì´ë¯¸ì§€ URL ì…ë ¥" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            <div id="bulletinImagePreview" style="margin-top: 10px;"></div>
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <button type="button" onclick="closeBulletinModal()" class="btn-small" style="background: #6c757d; margin-right: 10px;">ì·¨ì†Œ</button>
                            <button type="submit" class="btn-small">ì €ì¥</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- êµíšŒì†Œì‹ ë°” ê´€ë¦¬ ëª¨ë‹¬ -->
            <div id="newsScrollModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 600px;">
                    <span class="close" onclick="closeNewsScrollModal()">&times;</span>
                    <h2 id="newsScrollModalTitle">ìƒˆ ì†Œì‹ ì¶”ê°€</h2>
                    <form id="newsScrollForm" onsubmit="saveNewsScroll(event)">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì†Œì‹ ë‚´ìš© *</label>
                            <textarea id="newsScrollText" required rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit; resize: vertical;" placeholder="ì˜ˆ: 11ì›” 3ì¼ ì—˜ë¦¼í–‰ë³µì¶•ì œ ìœ„ë¡œ(Weè·¯) í–‰ì‚¬ê°€ ì§„í–‰ë©ë‹ˆë‹¤."></textarea>
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <button type="button" onclick="closeNewsScrollModal()" class="btn-small" style="background: #6c757d; margin-right: 10px;">ì·¨ì†Œ</button>
                            <button type="submit" class="btn-small">ì €ì¥</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- ê²Œì‹œê¸€ ì‘ì„±/ìˆ˜ì • ëª¨ë‹¬ -->
            <div id="boardPostModal" class="modal" style="display: none;">
                <div class="modal-content" style="max-width: 700px;">
                    <span class="close" onclick="closeBoardPostModal()">&times;</span>
                    <h2 id="boardPostModalTitle">ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h2>
                    <form id="boardPostForm" onsubmit="saveBoardPost(event)">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ì œëª© *</label>
                            <input type="text" id="boardPostTitle" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ë‚´ìš© *</label>
                            <textarea id="boardPostContent" required rows="10" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-family: inherit; resize: vertical;"></textarea>
                        </div>
                        <div style="text-align: right; margin-top: 20px;">
                            <button type="button" onclick="closeBoardPostModal()" class="btn-small" style="background: #6c757d; margin-right: 10px;">ì·¨ì†Œ</button>
                            <button type="submit" class="btn-small">ì €ì¥</button>
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="admin-section">
                <h2>ê¸°íƒ€ ì„¤ì •</h2>
                <button onclick="resetAll()" class="btn-small" style="background: #dc3545; color: white;">ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”</button>
            </div>
            
            <a href="index.html" class="back-link">â† í™ˆí˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
        
        <div class="status" id="status"></div>
    </div>
    
    <script src="api.js"></script>
    <script>
        const ADMIN_STORAGE_KEY = 'elim-admin-auth';
        const STORAGE_KEY = 'elim-admin-data';
        
        let adminData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{"notices":[],"youtubeChannelId":"","videos":[],"albums":[],"bulletins":[],"newsScrollItems":[]}');
        
        // ì´ˆê¸° admin ì„¤ì •
        async function initAdmin() {
            // í™˜ê²½ ë³€ìˆ˜ì—ì„œ ê´€ë¦¬ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ë¯€ë¡œ ê¸°ë³¸ê°’ ì—†ìŒ
            // localStorageëŠ” API ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œì—ë§Œ ì‚¬ìš© (í™˜ê²½ ë³€ìˆ˜ ê¸°ë°˜)
            const adminData = localStorage.getItem(ADMIN_STORAGE_KEY);
            // ê¸°ë³¸ê°’ í•˜ë“œì½”ë”© ì œê±° - ë³´ì•ˆìƒ í™˜ê²½ ë³€ìˆ˜ë§Œ ì‚¬ìš©
        }
        
        async function checkPassword() {
            const id = document.getElementById('adminId').value;
            const pw = document.getElementById('password').value;
            
            if (!id || !pw) {
                alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            // APIë¥¼ í†µí•œ ë¡œê·¸ì¸ ì‹œë„
            try {
                const result = await loginAPI(id, pw);
                if (result.success) {
                    sessionStorage.setItem('adminLoggedIn', 'true');
                    showAdminMenu();
                    await loadData();
                    return;
                }
            } catch (error) {
                console.log('API ë¡œê·¸ì¸ ì‹¤íŒ¨, localStorageë¡œ í´ë°±:', error);
            }
            
            // í´ë°±: localStorage ì‚¬ìš©
            await initAdmin();
            
            const adminData = JSON.parse(localStorage.getItem(ADMIN_STORAGE_KEY) || '{}');
            const idHash = await hashString(id);
            const pwHash = await hashString(pw);
            
            if (adminData.idHash === idHash && adminData.pwHash === pwHash) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                showAdminMenu();
                await loadData();
            } else {
                alert('ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }
        
        async function hashString(str) {
            const encoder = new TextEncoder();
            const data = encoder.encode(str);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }
        
        function showAdminMenu() {
            document.getElementById('loginBox').style.display = 'none';
            document.getElementById('adminMenu').classList.add('active');
        }
        
        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(adminData));
        }
        
        function showStatus(message) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }
        
        async function loadData() {
            // ê³µì§€ì‚¬í•­ ë¡œë“œ
            renderNotices();
            
            // YouTube ì±„ë„ ì„¤ì • ë¡œë“œ
            try {
                const settings = await settingsAPI.getSettings();
                const channelId = settings.youtubeChannelId || '';
                document.getElementById('youtubeChannelId').value = channelId;
                adminData.youtubeChannelId = channelId;
            } catch (error) {
                console.error('ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                // í´ë°±: localStorage ì‚¬ìš©
                const savedChannelId = localStorage.getItem('youtubeChannelId') || adminData.youtubeChannelId || '';
                document.getElementById('youtubeChannelId').value = savedChannelId;
                adminData.youtubeChannelId = savedChannelId;
            }
            
            // ì˜ìƒ ëª©ë¡ ë¡œë“œ
            await loadVideos();
            
            await loadAlbums();
            await loadBulletins();
            await loadNewsScrollItems();
            renderNewsScrollItems();
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            const modal = document.getElementById('bulletinModal');
            if (modal) {
                window.onclick = function(event) {
                    if (event.target === modal) {
                        closeBulletinModal();
                    }
                }
            }
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            const boardModal = document.getElementById('boardPostModal');
            if (boardModal) {
                window.onclick = function(event) {
                    if (event.target === boardModal) {
                        closeBoardPostModal();
                    }
                }
            }
            
            // êµíšŒì†Œì‹ ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            const newsScrollModal = document.getElementById('newsScrollModal');
            if (newsScrollModal) {
                window.onclick = function(event) {
                    if (event.target === newsScrollModal) {
                        closeNewsScrollModal();
                    }
                }
            }
            
            // ê²Œì‹œíŒ ê²Œì‹œê¸€ ë¡œë“œ
            await loadBoardPosts();
        }
        
        function addNotice() {
            const title = prompt('ê³µì§€ì‚¬í•­ ì œëª©:');
            if (!title) return;
            
            const date = new Date().toLocaleDateString('ko-KR');
            adminData.notices.push({
                title: title,
                content: '',
                date: date,
                category: 'ê³µì§€'
            });
            saveData();
            renderNotices();
            showStatus('ê³µì§€ì‚¬í•­ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        
        function renderNotices() {
            const container = document.getElementById('noticeList');
            container.innerHTML = '';
            adminData.notices.forEach((notice, index) => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <input type="text" value="${notice.title}" onchange="updateNoticeTitle(${index}, this.value)">
                    <input type="text" value="${notice.date}" onchange="updateNoticeDate(${index}, this.value)">
                    <textarea onchange="updateNoticeContent(${index}, this.value)">${notice.content}</textarea>
                    <button onclick="deleteNotice(${index})" style="background: #dc3545;">ì‚­ì œ</button>
                `;
                container.appendChild(div);
            });
        }
        
        function updateNoticeTitle(index, value) {
            adminData.notices[index].title = value;
            saveData();
        }
        
        function updateNoticeDate(index, value) {
            adminData.notices[index].date = value;
            saveData();
        }
        
        function updateNoticeContent(index, value) {
            adminData.notices[index].content = value;
            saveData();
        }
        
        function deleteNotice(index) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                adminData.notices.splice(index, 1);
                saveData();
                renderNotices();
                showStatus('ê³µì§€ì‚¬í•­ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        async function saveChannelId() {
            const channelId = document.getElementById('youtubeChannelId').value.trim();
            if (!channelId) {
                alert('ì±„ë„ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                await settingsAPI.updateSettings(channelId);
                adminData.youtubeChannelId = channelId;
                // sermons.htmlì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë³„ë„ë¡œ ì €ì¥ (í´ë°±ìš©)
                localStorage.setItem('youtubeChannelId', channelId);
                showStatus('YouTube ì±„ë„ IDê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. ì„¤êµì˜ìƒ í˜ì´ì§€ì—ì„œ ìë™ìœ¼ë¡œ ìµœì‹  ì˜ìƒì´ í‘œì‹œë©ë‹ˆë‹¤.');
            } catch (error) {
                console.error('ì±„ë„ ID ì €ì¥ ì‹¤íŒ¨:', error);
                // í´ë°±: localStorage ì‚¬ìš©
                adminData.youtubeChannelId = channelId;
                saveData();
                localStorage.setItem('youtubeChannelId', channelId);
                showStatus('YouTube ì±„ë„ IDê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥)');
            }
        }
        
        async function addVideoUrl() {
            const url = document.getElementById('videoUrl').value;
            if (!url) return;
            
            const videoId = extractVideoId(url);
            if (videoId) {
                try {
                    await videosAPI.createVideo(videoId);
                    document.getElementById('videoUrl').value = '';
                    showStatus('ì˜ìƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadVideos();
                } catch (error) {
                    console.error('ì˜ìƒ ì¶”ê°€ ì‹¤íŒ¨:', error);
                    // í´ë°±: localStorage ì‚¬ìš©
                    adminData.videos.push(videoId);
                    saveData();
                    renderVideos();
                    document.getElementById('videoUrl').value = '';
                    showStatus('ì˜ìƒì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥)');
                }
            } else {
                alert('ì˜¬ë°”ë¥¸ YouTube URLì„ ì…ë ¥í•˜ì„¸ìš”.');
            }
        }
        
        function extractVideoId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
        
        async function loadVideos() {
            try {
                const videos = await videosAPI.getVideos();
                adminData.videos = videos.map(v => v.videoId || v.id);
                renderVideos();
            } catch (error) {
                console.error('ì˜ìƒ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
                // í´ë°±: localStorage ì‚¬ìš©
                const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                adminData.videos = savedData.videos || [];
                renderVideos();
            }
        }
        
        function renderVideos() {
            const container = document.getElementById('videoList');
            container.innerHTML = '';
            if (!adminData.videos || adminData.videos.length === 0) {
                container.innerHTML = '<p style="color: #666;">ë“±ë¡ëœ ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            adminData.videos.forEach((videoId, index) => {
                const div = document.createElement('div');
                div.style.marginBottom = '10px';
                div.style.padding = '10px';
                div.style.border = '1px solid #ddd';
                div.style.borderRadius = '5px';
                div.innerHTML = `
                    <span>Video ID: ${videoId}</span>
                    <button onclick="deleteVideo('${videoId}')" style="background: #dc3545; margin-left: 10px; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer;">ì‚­ì œ</button>
                `;
                container.appendChild(div);
            });
        }
        
        async function deleteVideo(videoId) {
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                // GitHubì—ì„œ ì˜ìƒ ëª©ë¡ì„ ê°€ì ¸ì™€ì„œ í•´ë‹¹ videoIdë¥¼ ê°€ì§„ í•­ëª© ì°¾ê¸°
                const videos = await videosAPI.getVideos();
                const video = videos.find(v => (v.videoId || v.id) === videoId);
                if (video && video.id) {
                    await videosAPI.deleteVideo(video.id);
                    showStatus('ì˜ìƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadVideos();
                } else {
                    throw new Error('ì˜ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì˜ìƒ ì‚­ì œ ì‹¤íŒ¨:', error);
                // í´ë°±: localStorage ì‚¬ìš©
                const index = adminData.videos.indexOf(videoId);
                if (index > -1) {
                    adminData.videos.splice(index, 1);
                    saveData();
                    renderVideos();
                    showStatus('ì˜ìƒì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥)');
                }
            }
        }
        
        // í–‰ì‚¬ì•¨ë²” ê´€ë¦¬
        async function handleAlbumImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = async function(e) {
                const base64Image = e.target.result;
                
                try {
                    await albumAPI.createAlbum(base64Image);
                    showStatus('ì‚¬ì§„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    await loadAlbums();
                    document.getElementById('albumImageFile').value = '';
                } catch (error) {
                    console.log('API ì €ì¥ ì‹¤íŒ¨, localStorageë¡œ í´ë°±:', error);
                    // í´ë°±: localStorage ì‚¬ìš©
                    if (!adminData.albums) {
                        adminData.albums = [];
                    }
                    
                    adminData.albums.push({
                        id: Date.now(),
                        imageUrl: base64Image
                    });
                    saveData();
                    renderAlbums();
                    document.getElementById('albumImageFile').value = '';
                    showStatus('ì‚¬ì§„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            };
            reader.readAsDataURL(file);
        }
        
        async function addAlbumImageFromUrl() {
            const url = document.getElementById('albumImageUrl').value.trim();
            if (!url) {
                alert('ì´ë¯¸ì§€ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                await albumAPI.createAlbum(url);
                showStatus('ì‚¬ì§„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                await loadAlbums();
                document.getElementById('albumImageUrl').value = '';
            } catch (error) {
                console.log('API ì €ì¥ ì‹¤íŒ¨, localStorageë¡œ í´ë°±:', error);
                // í´ë°±: localStorage ì‚¬ìš©
                if (!adminData.albums) {
                    adminData.albums = [];
                }
                
                adminData.albums.push({
                    id: Date.now(),
                    imageUrl: url
                });
                saveData();
                renderAlbums();
                document.getElementById('albumImageUrl').value = '';
                showStatus('ì‚¬ì§„ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        async function loadAlbums() {
            try {
                const result = await albumAPI.getAlbums();
                if (result && result.length > 0) {
                    adminData.albums = result.map(a => ({
                        id: a.id,
                        imageUrl: a.image_url
                    }));
                    saveData();
                }
                renderAlbums();
            } catch (error) {
                console.log('API ë¡œë“œ ì‹¤íŒ¨, localStorage ì‚¬ìš©:', error);
                renderAlbums();
            }
        }
        
        function renderAlbums() {
            const container = document.getElementById('albumList');
            if (!container) return;
            
            container.innerHTML = '';
            if (!adminData.albums || adminData.albums.length === 0) {
                container.innerHTML = '<p style="color: #999;">ì¶”ê°€ëœ ì‚¬ì§„ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            adminData.albums.forEach((album, index) => {
                const div = document.createElement('div');
                div.style.cssText = 'margin-bottom: 15px; padding: 15px; background: white; border: 1px solid #ddd; border-radius: 5px; display: flex; align-items: center; gap: 15px;';
                const imageDisplay = album.imageUrl.length > 100 ? 
                    `<img src="${album.imageUrl.substring(0, 100)}..." alt="ì•¨ë²” ì‚¬ì§„" style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3Eì´ë¯¸ì§€ ì—†ìŒ%3C/text%3E%3C/svg%3E'">` :
                    `<img src="${album.imageUrl}" alt="ì•¨ë²” ì‚¬ì§„" style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px;" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 text-anchor=%22middle%22 dy=%22.3em%22 fill=%22%23999%22%3Eì´ë¯¸ì§€ ì—†ìŒ%3C/text%3E%3C/svg%3E'">`;
                
                div.innerHTML = `
                    ${imageDisplay}
                    <div style="flex: 1;">
                        <p style="word-break: break-all; font-size: 0.9rem; color: #666;">${album.imageUrl.length > 100 ? 'ì—…ë¡œë“œëœ ì´ë¯¸ì§€' : album.imageUrl}</p>
                    </div>
                    <button onclick="deleteAlbumImage(${index})" style="background: #dc3545; padding: 8px 16px; font-size: 0.9rem; color: white; border: none; border-radius: 5px; cursor: pointer;">ì‚­ì œ</button>
                `;
                container.appendChild(div);
            });
        }
        
        async function deleteAlbumImage(index) {
            if (!confirm('ì´ ì‚¬ì§„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const album = adminData.albums[index];
                await albumAPI.deleteAlbum(album.id);
                adminData.albums.splice(index, 1);
                saveData();
                renderAlbums();
                showStatus('ì‚¬ì§„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.log('API ì‚­ì œ ì‹¤íŒ¨, localStorageë¡œ í´ë°±:', error);
                adminData.albums.splice(index, 1);
                saveData();
                renderAlbums();
                showStatus('ì‚¬ì§„ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì£¼ë³´ê´‘ê³  ê´€ë¦¬
        let editingBulletinIndex = null;
        let bulletinImageBase64 = null;
        
        function openBulletinModal(index = null) {
            editingBulletinIndex = index;
            const modal = document.getElementById('bulletinModal');
            const form = document.getElementById('bulletinForm');
            const titleInput = document.getElementById('bulletinTitle');
            const dateInput = document.getElementById('bulletinDate');
            const contentInput = document.getElementById('bulletinContent');
            const imageUrlInput = document.getElementById('bulletinImageUrl');
            const imageFileInput = document.getElementById('bulletinImageFile');
            const previewDiv = document.getElementById('bulletinImagePreview');
            const modalTitle = document.getElementById('bulletinModalTitle');
            
            // í¼ ì´ˆê¸°í™”
            form.reset();
            bulletinImageBase64 = null;
            previewDiv.innerHTML = '';
            
            if (index !== null) {
                // ìˆ˜ì • ëª¨ë“œ
                modalTitle.textContent = 'ì£¼ë³´ ìˆ˜ì •';
                const bulletin = adminData.bulletins[index];
                titleInput.value = bulletin.title || '';
                dateInput.value = bulletin.date || '';
                contentInput.value = bulletin.content || '';
                imageUrlInput.value = bulletin.imageUrl || '';
                
                if (bulletin.imageUrl) {
                    if (bulletin.imageUrl.startsWith('data:image')) {
                        bulletinImageBase64 = bulletin.imageUrl;
                        previewDiv.innerHTML = `<img src="${bulletin.imageUrl}" alt="ë¯¸ë¦¬ë³´ê¸°" style="max-width: 200px; max-height: 200px; border-radius: 5px; margin-top: 10px;">`;
                    } else {
                        imageUrlInput.value = bulletin.imageUrl;
                        previewDiv.innerHTML = `<img src="${bulletin.imageUrl}" alt="ë¯¸ë¦¬ë³´ê¸°" style="max-width: 200px; max-height: 200px; border-radius: 5px; margin-top: 10px;" onerror="this.style.display='none'">`;
                    }
                }
            } else {
                // ìƒˆë¡œ ì¶”ê°€ ëª¨ë“œ
                modalTitle.textContent = 'ìƒˆ ì£¼ë³´ ì¶”ê°€';
                const today = new Date();
                dateInput.value = today.toLocaleDateString('ko-KR').replace(/\. /g, '.').replace(/\.$/, '');
            }
            
            modal.style.display = 'flex';
        }
        
        function closeBulletinModal() {
            const modal = document.getElementById('bulletinModal');
            modal.style.display = 'none';
            editingBulletinIndex = null;
            bulletinImageBase64 = null;
            document.getElementById('bulletinForm').reset();
            document.getElementById('bulletinImagePreview').innerHTML = '';
        }
        
        function handleBulletinImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                bulletinImageBase64 = e.target.result;
                const previewDiv = document.getElementById('bulletinImagePreview');
                previewDiv.innerHTML = `<img src="${bulletinImageBase64}" alt="ë¯¸ë¦¬ë³´ê¸°" style="max-width: 200px; max-height: 200px; border-radius: 5px; margin-top: 10px;">`;
            };
            reader.readAsDataURL(file);
        }
        
        async function saveBulletin(event) {
            event.preventDefault();
            
            const title = document.getElementById('bulletinTitle').value.trim();
            const date = document.getElementById('bulletinDate').value.trim();
            const content = document.getElementById('bulletinContent').value.trim();
            const imageUrl = document.getElementById('bulletinImageUrl').value.trim();
            
            if (!title || !date) {
                alert('ì œëª©ê³¼ ë‚ ì§œëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                return;
            }
            
            // ì´ë¯¸ì§€ URL ê²°ì • (ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ > URL ì…ë ¥)
            let finalImageUrl = '';
            if (bulletinImageBase64) {
                finalImageUrl = bulletinImageBase64;
            } else if (imageUrl) {
                finalImageUrl = imageUrl;
            }
            
            try {
                if (editingBulletinIndex !== null) {
                    // ìˆ˜ì •
                    const bulletin = adminData.bulletins[editingBulletinIndex];
                    await bulletinAPI.updateBulletin(bulletin.id, title, date, content, finalImageUrl);
                    // localStorageì—ë„ ì €ì¥
                    adminData.bulletins[editingBulletinIndex].title = title;
                    adminData.bulletins[editingBulletinIndex].date = date;
                    adminData.bulletins[editingBulletinIndex].content = content;
                    adminData.bulletins[editingBulletinIndex].imageUrl = finalImageUrl;
                    saveData();
                    showStatus('ì£¼ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    // ìƒˆë¡œ ì¶”ê°€
                    const result = await bulletinAPI.createBulletin(title, date, content, finalImageUrl);
                    // APIì—ì„œ ë°˜í™˜ëœ ë°ì´í„°ë¥¼ ì‚¬ìš© (IDê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë¨)
                    if (!adminData.bulletins) {
                        adminData.bulletins = [];
                    }
                    if (result && result.bulletin) {
                        // APIì—ì„œ ë°˜í™˜ëœ ì£¼ë³´ ë°ì´í„° ì‚¬ìš©
                        adminData.bulletins.push({
                            id: result.bulletin.id,
                            title: result.bulletin.title,
                            date: result.bulletin.date,
                            content: result.bulletin.content || '',
                            imageUrl: result.bulletin.image_url || result.bulletin.imageUrl || finalImageUrl
                        });
                    } else {
                        // í´ë°±: ì§ì ‘ ì¶”ê°€
                        adminData.bulletins.push({
                            id: Date.now(),
                            title: title,
                            date: date,
                            content: content,
                            imageUrl: finalImageUrl
                        });
                    }
                    saveData();
                    showStatus('ì£¼ë³´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (APIì—ì„œ ìµœì‹  ë°ì´í„° ê°€ì ¸ì˜¤ê¸°)
                await loadBulletins();
                closeBulletinModal();
            } catch (error) {
                console.log('API ì €ì¥ ì‹¤íŒ¨, localStorageë¡œ í´ë°±:', error);
                // í´ë°±: localStorage ì‚¬ìš©
                if (!adminData.bulletins) {
                    adminData.bulletins = [];
                }
                
                if (editingBulletinIndex !== null) {
                    adminData.bulletins[editingBulletinIndex].title = title;
                    adminData.bulletins[editingBulletinIndex].date = date;
                    adminData.bulletins[editingBulletinIndex].content = content;
                    adminData.bulletins[editingBulletinIndex].imageUrl = finalImageUrl;
                    showStatus('ì£¼ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    adminData.bulletins.push({
                        id: Date.now(),
                        title: title,
                        date: date,
                        content: content,
                        imageUrl: finalImageUrl
                    });
                    showStatus('ì£¼ë³´ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
                saveData();
                renderBulletins();
                closeBulletinModal();
            }
        }
        
        async function loadBulletins() {
            try {
                const result = await bulletinAPI.getBulletins();
                if (result && result.length > 0) {
                    // APIì—ì„œ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¨ ê²½ìš°
                    adminData.bulletins = result.map(b => ({
                        id: b.id,
                        title: b.title,
                        date: b.date,
                        content: b.content,
                        imageUrl: b.image_url || b.imageUrl
                    }));
                    saveData();
                } else {
                    // APIê°€ ë¹ˆ ë°°ì—´ì„ ë°˜í™˜í•œ ê²½ìš°, localStorage í™•ì¸
                    const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                    if (savedData.bulletins && savedData.bulletins.length > 0) {
                        adminData.bulletins = savedData.bulletins;
                        console.log('APIì—ì„œ ë°ì´í„°ê°€ ì—†ì–´ localStorage ì‚¬ìš©');
                    } else if (!adminData.bulletins) {
                        adminData.bulletins = [];
                    }
                }
                renderBulletins();
            } catch (error) {
                console.error('API ë¡œë“œ ì‹¤íŒ¨, localStorage ì‚¬ìš©:', error);
                // API ì‹¤íŒ¨ ì‹œ localStorageì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
                const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                if (savedData.bulletins && savedData.bulletins.length > 0) {
                    adminData.bulletins = savedData.bulletins;
                } else if (!adminData.bulletins) {
                    adminData.bulletins = [];
                }
                renderBulletins();
            }
        }
        
        function renderBulletins() {
            const container = document.getElementById('bulletinList');
            if (!container) return;
            
            container.innerHTML = '';
            if (!adminData.bulletins || adminData.bulletins.length === 0) {
                container.innerHTML = '<p style="color: #999;">ì¶”ê°€ëœ ì£¼ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
            const sortedBulletins = [...adminData.bulletins].sort((a, b) => {
                const dateA = new Date(a.date.replace(/\./g, '-'));
                const dateB = new Date(b.date.replace(/\./g, '-'));
                return dateB - dateA;
            });
            
            sortedBulletins.forEach((bulletin, index) => {
                const originalIndex = adminData.bulletins.findIndex(b => b.id === bulletin.id);
                const div = document.createElement('div');
                div.style.cssText = 'margin-bottom: 15px; padding: 15px; background: white; border: 1px solid #ddd; border-radius: 5px;';
                div.innerHTML = `
                    <div style="display: flex; gap: 15px; align-items: start;">
                        ${bulletin.imageUrl ? `<img src="${bulletin.imageUrl}" alt="ì£¼ë³´ ì´ë¯¸ì§€" style="width: 80px; height: 80px; object-fit: cover; border-radius: 5px;" onerror="this.style.display='none'">` : ''}
                        <div style="flex: 1;">
                            <div style="margin-bottom: 8px;">
                                <strong>${bulletin.title}</strong>
                            </div>
                            <div style="margin-bottom: 8px; font-size: 0.9rem; color: #666;">
                                ğŸ“… ${bulletin.date}
                            </div>
                            ${bulletin.content ? `<div style="margin-bottom: 8px; font-size: 0.9rem; color: #555;">${bulletin.content.substring(0, 100)}${bulletin.content.length > 100 ? '...' : ''}</div>` : ''}
                            <div style="margin-top: 10px;">
                                <button onclick="openBulletinModal(${originalIndex})" style="background: #2C5F8D; color: white; padding: 8px 16px; font-size: 0.9rem; border: none; border-radius: 5px; cursor: pointer; margin-right: 5px;">ìˆ˜ì •</button>
                                <button onclick="deleteBulletin(${originalIndex})" style="background: #dc3545; color: white; padding: 8px 16px; font-size: 0.9rem; border: none; border-radius: 5px; cursor: pointer;">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        async function deleteBulletin(index) {
            if (!confirm('ì´ ì£¼ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const bulletin = adminData.bulletins[index];
                await bulletinAPI.deleteBulletin(bulletin.id);
                adminData.bulletins.splice(index, 1);
                saveData();
                renderBulletins();
                showStatus('ì£¼ë³´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.log('API ì‚­ì œ ì‹¤íŒ¨, localStorageë¡œ í´ë°±:', error);
                adminData.bulletins.splice(index, 1);
                saveData();
                renderBulletins();
                showStatus('ì£¼ë³´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        // ê²Œì‹œíŒ ê´€ë¦¬
        let allBoardPosts = [];
        let editingBoardPostIndex = null;
        let filteredBoardPosts = [];
        
        async function loadBoardPosts() {
            try {
                const container = document.getElementById('boardPostList');
                container.innerHTML = '<p style="color: #666; text-align: center;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
                
                const posts = await boardAPI.getPosts();
                // API ë°ì´í„° í˜•ì‹ ë³€í™˜
                allBoardPosts = posts.map(post => ({
                    id: post.id,
                    title: post.title,
                    content: post.content,
                    author: post.author || 'ê´€ë¦¬ì',
                    date: post.created_at ? new Date(post.created_at).getTime() : (post.date || Date.now()),
                    created_at: post.created_at || new Date(post.date || Date.now()).toISOString()
                }));
                
                // ë‚ ì§œìˆœ ì •ë ¬ (ìµœì‹ ìˆœ)
                allBoardPosts.sort((a, b) => b.date - a.date);
                filteredBoardPosts = [...allBoardPosts];
                
                renderBoardPosts();
                showStatus('ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ë¡œë“œ ì‹¤íŒ¨:', error);
                const container = document.getElementById('boardPostList');
                container.innerHTML = '<p style="color: #dc3545;">ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
            }
        }
        
        function filterBoardPosts() {
            const searchTerm = document.getElementById('boardSearch').value.toLowerCase();
            if (!searchTerm) {
                filteredBoardPosts = [...allBoardPosts];
            } else {
                filteredBoardPosts = allBoardPosts.filter(post => 
                    post.title.toLowerCase().includes(searchTerm) || 
                    post.content.toLowerCase().includes(searchTerm)
                );
            }
            renderBoardPosts();
        }
        
        function renderBoardPosts() {
            const container = document.getElementById('boardPostList');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (!filteredBoardPosts || filteredBoardPosts.length === 0) {
                container.innerHTML = '<p style="color: #999; text-align: center;">ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            filteredBoardPosts.forEach((post, index) => {
                const originalIndex = allBoardPosts.findIndex(p => p.id === post.id);
                const postDate = new Date(post.date).toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const div = document.createElement('div');
                div.style.cssText = 'margin-bottom: 15px; padding: 20px; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);';
                div.innerHTML = `
                    <div style="margin-bottom: 12px;">
                        <h3 style="margin: 0 0 8px 0; color: #2C3E50; font-size: 1.1rem; font-weight: 600;">${post.title}</h3>
                        <div style="font-size: 0.85rem; color: #666; margin-bottom: 10px;">
                            <span>ğŸ“… ${postDate}</span>
                            <span style="margin-left: 15px;">ğŸ‘¤ ${post.author || 'ê´€ë¦¬ì'}</span>
                        </div>
                        <div style="font-size: 0.9rem; color: #555; line-height: 1.6; margin-bottom: 15px; max-height: 80px; overflow: hidden; text-overflow: ellipsis;">
                            ${post.content.replace(/\n/g, '<br>').substring(0, 150)}${post.content.length > 150 ? '...' : ''}
                        </div>
                        <div style="display: flex; gap: 10px; margin-top: 15px;">
                            <button onclick="viewBoardPost(${originalIndex})" style="background: #17a2b8; color: white; padding: 8px 16px; font-size: 0.9rem; border: none; border-radius: 5px; cursor: pointer;">ìƒì„¸ë³´ê¸°</button>
                            <button onclick="openBoardPostModal(${originalIndex})" style="background: #2C5F8D; color: white; padding: 8px 16px; font-size: 0.9rem; border: none; border-radius: 5px; cursor: pointer;">ìˆ˜ì •</button>
                            <button onclick="deleteBoardPost(${originalIndex})" style="background: #dc3545; color: white; padding: 8px 16px; font-size: 0.9rem; border: none; border-radius: 5px; cursor: pointer;">ì‚­ì œ</button>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        function viewBoardPost(index) {
            const post = allBoardPosts[index];
            if (!post) return;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 800px;">
                    <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                    <h2 style="margin-bottom: 20px; color: #2C3E50;">${post.title}</h2>
                    <div style="margin-bottom: 20px; font-size: 0.9rem; color: #666; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                        <span>ğŸ“… ${new Date(post.date).toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' })}</span>
                        <span style="margin-left: 15px;">ğŸ‘¤ ${post.author || 'ê´€ë¦¬ì'}</span>
                    </div>
                    <div style="line-height: 1.8; color: #333; white-space: pre-wrap; font-size: 0.95rem; padding: 20px; background: #f9f9f9; border-radius: 5px;">
                        ${post.content.replace(/\n/g, '<br>')}
                    </div>
                    <div style="margin-top: 20px; text-align: right;">
                        <button onclick="openBoardPostModal(${index})" class="btn-small" style="background: #2C5F8D; margin-right: 10px;">ìˆ˜ì •</button>
                        <button onclick="deleteBoardPost(${index}); this.closest('.modal').remove();" class="btn-small" style="background: #dc3545; margin-right: 10px;">ì‚­ì œ</button>
                        <button onclick="this.closest('.modal').remove()" class="btn-small" style="background: #6c757d;">ë‹«ê¸°</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            modal.onclick = function(event) {
                if (event.target === modal) {
                    modal.remove();
                }
            };
        }
        
        function openBoardPostModal(index = null) {
            editingBoardPostIndex = index;
            const modal = document.getElementById('boardPostModal');
            if (!modal) {
                console.error('boardPostModalì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                alert('ëª¨ë‹¬ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const form = document.getElementById('boardPostForm');
            const titleInput = document.getElementById('boardPostTitle');
            const contentInput = document.getElementById('boardPostContent');
            const modalTitle = document.getElementById('boardPostModalTitle');
            
            if (!form || !titleInput || !contentInput || !modalTitle) {
                console.error('ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                alert('ëª¨ë‹¬ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // í¼ ì´ˆê¸°í™”
            form.reset();
            
            if (index !== null) {
                // ìˆ˜ì • ëª¨ë“œ
                modalTitle.textContent = 'ê²Œì‹œê¸€ ìˆ˜ì •';
                const post = allBoardPosts[index];
                if (post) {
                    titleInput.value = post.title || '';
                    contentInput.value = post.content || '';
                }
            } else {
                // ìƒˆë¡œ ì¶”ê°€ ëª¨ë“œ
                modalTitle.textContent = 'ìƒˆ ê²Œì‹œê¸€ ì‘ì„±';
            }
            
            modal.style.display = 'flex';
        }
        
        function closeBoardPostModal() {
            const modal = document.getElementById('boardPostModal');
            modal.style.display = 'none';
            editingBoardPostIndex = null;
            document.getElementById('boardPostForm').reset();
        }
        
        async function saveBoardPost(event) {
            event.preventDefault();
            
            const title = document.getElementById('boardPostTitle').value.trim();
            const content = document.getElementById('boardPostContent').value.trim();
            
            if (!title || !content) {
                alert('ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                if (editingBoardPostIndex !== null) {
                    // ìˆ˜ì •
                    const post = allBoardPosts[editingBoardPostIndex];
                    const result = await boardAPI.updatePost(post.id, title, content);
                    if (result && result.error) {
                        alert('ì˜¤ë¥˜: ' + result.error);
                        return;
                    }
                    showStatus('ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    // ìƒˆë¡œ ì¶”ê°€
                    const result = await boardAPI.createPost(title, content);
                    if (result && result.error) {
                        alert('ì˜¤ë¥˜: ' + result.error);
                        return;
                    }
                    if (!result || !result.success) {
                        alert('ê²Œì‹œê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                        return;
                    }
                    showStatus('ê²Œì‹œê¸€ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
                closeBoardPostModal();
                await loadBoardPosts();
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ê²Œì‹œê¸€ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (error.message || error));
            }
        }
        
        async function deleteBoardPost(index) {
            if (!confirm('ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const post = allBoardPosts[index];
                await boardAPI.deletePost(post.id);
                allBoardPosts.splice(index, 1);
                filteredBoardPosts = allBoardPosts.filter(p => 
                    !document.getElementById('boardSearch').value || 
                    p.title.toLowerCase().includes(document.getElementById('boardSearch').value.toLowerCase()) ||
                    p.content.toLowerCase().includes(document.getElementById('boardSearch').value.toLowerCase())
                );
                renderBoardPosts();
                showStatus('ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.error('ê²Œì‹œê¸€ ì‚­ì œ ì‹¤íŒ¨:', error);
                alert('ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + (error.message || error));
            }
        }
        
        // êµíšŒì†Œì‹ ë°” ê´€ë¦¬
        let editingNewsScrollIndex = null;
        
        function openNewsScrollModal(index = null) {
            editingNewsScrollIndex = index;
            const modal = document.getElementById('newsScrollModal');
            const form = document.getElementById('newsScrollForm');
            const textInput = document.getElementById('newsScrollText');
            const modalTitle = document.getElementById('newsScrollModalTitle');
            
            form.reset();
            
            if (index !== null) {
                modalTitle.textContent = 'ì†Œì‹ ìˆ˜ì •';
                const item = adminData.newsScrollItems[index];
                textInput.value = item.text || '';
            } else {
                modalTitle.textContent = 'ìƒˆ ì†Œì‹ ì¶”ê°€';
            }
            
            modal.style.display = 'flex';
        }
        
        function closeNewsScrollModal() {
            const modal = document.getElementById('newsScrollModal');
            modal.style.display = 'none';
            editingNewsScrollIndex = null;
            document.getElementById('newsScrollForm').reset();
        }
        
        async function saveNewsScroll(event) {
            event.preventDefault();
            
            const text = document.getElementById('newsScrollText').value.trim();
            
            if (!text) {
                alert('ì†Œì‹ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                if (editingNewsScrollIndex !== null) {
                    // ìˆ˜ì •
                    const item = adminData.newsScrollItems[editingNewsScrollIndex];
                    const result = await newsScrollAPI.updateNewsScrollItem(item.id, text);
                    if (result && result.error) {
                        alert('ì˜¤ë¥˜: ' + result.error);
                        return;
                    }
                    // localStorageì—ë„ ì €ì¥
                    adminData.newsScrollItems[editingNewsScrollIndex].text = text;
                    saveData();
                    showStatus('ì†Œì‹ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    // ìƒˆë¡œ ì¶”ê°€
                    const result = await newsScrollAPI.createNewsScrollItem(text);
                    if (result && result.error) {
                        alert('ì˜¤ë¥˜: ' + result.error);
                        return;
                    }
                    if (!adminData.newsScrollItems) {
                        adminData.newsScrollItems = [];
                    }
                    if (result && result.item) {
                        adminData.newsScrollItems.push({
                            id: result.item.id,
                            text: result.item.text || text
                        });
                    } else {
                        adminData.newsScrollItems.push({
                            id: Date.now(),
                            text: text
                        });
                    }
                    saveData();
                    showStatus('ì†Œì‹ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
                await loadNewsScrollItems();
                renderNewsScrollItems();
                closeNewsScrollModal();
            } catch (error) {
                console.log('API ì €ì¥ ì‹¤íŒ¨, localStorageë¡œ í´ë°±:', error);
                // í´ë°±: localStorage ì‚¬ìš©
                if (!adminData.newsScrollItems) {
                    adminData.newsScrollItems = [];
                }
                
                if (editingNewsScrollIndex !== null) {
                    adminData.newsScrollItems[editingNewsScrollIndex].text = text;
                    showStatus('ì†Œì‹ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥ì†Œì—ë§Œ ì €ì¥ë¨)');
                } else {
                    adminData.newsScrollItems.push({
                        id: Date.now(),
                        text: text
                    });
                    showStatus('ì†Œì‹ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ ì €ì¥ì†Œì—ë§Œ ì €ì¥ë¨)');
                }
                
                saveData();
                renderNewsScrollItems();
                closeNewsScrollModal();
            }
        }
        
        function renderNewsScrollItems() {
            const container = document.getElementById('newsScrollList');
            if (!container) return;
            
            container.innerHTML = '';
            if (!adminData.newsScrollItems || adminData.newsScrollItems.length === 0) {
                container.innerHTML = '<p style="color: #999;">ì¶”ê°€ëœ ì†Œì‹ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            adminData.newsScrollItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.style.cssText = 'margin-bottom: 15px; padding: 15px; background: white; border: 1px solid #ddd; border-radius: 5px; display: flex; justify-content: space-between; align-items: center;';
                div.innerHTML = `
                    <div style="flex: 1; padding-right: 15px;">
                        <p style="margin: 0; color: #333; font-size: 0.95rem; line-height: 1.6;">${item.text}</p>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button onclick="openNewsScrollModal(${index})" style="background: #2C5F8D; color: white; padding: 8px 16px; font-size: 0.9rem; border: none; border-radius: 5px; cursor: pointer;">ìˆ˜ì •</button>
                        <button onclick="deleteNewsScrollItem(${index})" style="background: #dc3545; color: white; padding: 8px 16px; font-size: 0.9rem; border: none; border-radius: 5px; cursor: pointer;">ì‚­ì œ</button>
                    </div>
                `;
                container.appendChild(div);
            });
        }
        
        async function deleteNewsScrollItem(index) {
            if (!confirm('ì´ ì†Œì‹ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const item = adminData.newsScrollItems[index];
                await newsScrollAPI.deleteNewsScrollItem(item.id);
                adminData.newsScrollItems.splice(index, 1);
                saveData();
                renderNewsScrollItems();
                showStatus('ì†Œì‹ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                console.log('API ì‚­ì œ ì‹¤íŒ¨, localStorageë¡œ í´ë°±:', error);
                adminData.newsScrollItems.splice(index, 1);
                saveData();
                renderNewsScrollItems();
                showStatus('ì†Œì‹ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }
        
        async function loadNewsScrollItems() {
            try {
                const result = await newsScrollAPI.getNewsScrollItems();
                if (result && result.length > 0) {
                    adminData.newsScrollItems = result.map(item => ({
                        id: item.id,
                        text: item.text
                    }));
                    saveData();
                } else {
                    // APIê°€ ë¹ˆ ë°°ì—´ì„ ë°˜í™˜í•œ ê²½ìš°, localStorage í™•ì¸
                    const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                    if (savedData.newsScrollItems && savedData.newsScrollItems.length > 0) {
                        adminData.newsScrollItems = savedData.newsScrollItems;
                    } else if (!adminData.newsScrollItems) {
                        adminData.newsScrollItems = [];
                    }
                }
            } catch (error) {
                console.error('API ë¡œë“œ ì‹¤íŒ¨, localStorage ì‚¬ìš©:', error);
                const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
                if (savedData.newsScrollItems && savedData.newsScrollItems.length > 0) {
                    adminData.newsScrollItems = savedData.newsScrollItems;
                } else if (!adminData.newsScrollItems) {
                    adminData.newsScrollItems = [];
                }
            }
        }
        
        function resetAll() {
            if (confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                localStorage.removeItem(STORAGE_KEY);
                location.reload();
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì„¸ì…˜ í™•ì¸
        window.addEventListener('load', async () => {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn') === 'true';
            if (isLoggedIn) {
                showAdminMenu();
                await loadData();
                await loadBoardPosts();
            }
        });
    </script>
</body>
</html>


